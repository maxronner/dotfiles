#!/usr/bin/env bash

selected=$(
  tmux list-sessions -F '#{session_activity}:#{session_name}: #{session_windows} windows #{?session_attached,(attached)}' |
  sort -n |
  sed 's/^[^:]*://' |
  FZF_TMUX_PANE_OPTS="center" fzf --exit-0 --multi --tmux --prompt="î¸• kill > "
)
if [ -z "$selected" ]; then
  exit 0
fi

echo "$selected" | while IFS= read -r i; do
  session_name="${i%%:*}"
  if [ -n "$session_name" ]; then
    if [[ "$session_name" == "$(tmux display-message -p '#S')" ]]; then
      tmux switch-client -l || tmux switch-client -p
    fi
    tmux kill-session -t "$session_name"
  fi
done
