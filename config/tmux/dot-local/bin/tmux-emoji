#!/usr/bin/env bash
set -euo pipefail

mode=${1:-insert}
caller_pane=$(tmux display-message -p '#{pane_id}')

fzf_emoji() {
  local query=${1:-}
  emojis=$(cat ~/.local/share/emoji.txt)
  selected_emoji=($(echo "$emojis" | fzf --query="$query" --multi --select-1 --exit-0 | awk '{print $1}' ))
  echo $selected_emoji
}

copy_clipboard() {
  if command -v wl-copy &>/dev/null; then
    wl-copy
  elif command -v xclip &>/dev/null; then
    xclip -selection clipboard
  elif command -v xsel &>/dev/null; then
    xsel --clipboard --input
  else
    echo "No clipboard utility found" >&2
    return 1
  fi
}

if [[ "$mode" == "clipboard" ]]; then
  emoji=$(fzf_emoji)
  if [[ -n "$emoji" ]]; then
    copy_clipboard <<< "$emoji"
  fi
else
  tmux popup -E "
    emojis=\$(cat ~/.local/share/emoji.txt)
    emoji=\$(echo \"\$emojis\" | fzf --multi --select-1 --exit-0 | awk '{print \$1}')
    tmux send-keys -t \"${caller_pane}\" \"\$emoji\"
  "
fi

