#!/usr/bin/env bash
set -euo pipefail

mode=${1:-insert}
caller_pane=$(tmux display-message -p '#{pane_id}')

copy_clipboard() {
  if command -v wl-copy &>/dev/null; then
    exec wl-copy
  elif command -v xclip &>/dev/null; then
    exec xclip -selection clipboard
  elif command -v xsel &>/dev/null; then
    exec xsel --clipboard --input
  else
    echo "No clipboard utility found" >&2
    return 1
  fi
}

if [[ "$mode" == "clipboard" ]]; then
  emoji=$(fzf-emoji)
  if [[ -n "$emoji" ]]; then
    printf %s "$emoji" | copy_clipboard
  fi
else
  tmux popup -E "
    emoji=\$(fzf-emoji)
    tmux send-keys -t \"${caller_pane}\" \"\$emoji\"
  "
fi

