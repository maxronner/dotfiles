#!/bin/bash
# Fix trailing newline in all staged text files

files=$(git diff --cached --name-only --diff-filter=ACM | grep -Ei '\.(c|h|py|go|rs|js|sh|lua|vim|md|txt|toml|json|ya?ml|conf|cfg|ini|log|lock)$|^(Makefile|Dockerfile|dockerfile|\.gitignore|\.gitattributes|\.gitmodules|mk|cmake|lock)$')

for file in $files; do
  if [ -f "$file" ] && [ "$(tail -c1 "$file")" != $'\n' ]; then
    echo >> "$file"
    git add "$file"
  fi
done

